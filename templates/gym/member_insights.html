{% extends 'base.html' %}
{% load static %}

{% block title %}My Insights{% endblock %}

{% block extra_css %}
<style>
    .insights-container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 1rem;
    }

    .dashboard-header {
        margin-bottom: 2rem;
    }

    .dashboard-header h1 {
        font-size: 2rem;
        color: #2d3748;
    }

    .grid-dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 1px solid #edf2f7;
    }

    .stat-title {
        font-size: 0.9rem;
        color: #718096;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2d3748;
    }

    .score-circle {
        position: relative;
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background: conic-gradient(#667eea calc(var(--score) * 1%), #edf2f7 0);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
    }

    .score-inner {
        width: 120px;
        height: 120px;
        background: white;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .score-number {
        font-size: 2.5rem;
        font-weight: 800;
        color: #667eea;
    }

    .risk-badge {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        display: inline-block;
    }

    .risk-low {
        background: #c6f6d5;
        color: #22543d;
    }

    .risk-medium {
        background: #feebc8;
        color: #744210;
    }

    .risk-high {
        background: #fed7d7;
        color: #742a2a;
    }

    .chart-container {
        grid-column: 1 / -1;
        background: white;
        padding: 2rem;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        margin-top: 2rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="insights-container">
    <div class="dashboard-header">
        <h1>Member Insights</h1>
        <p class="text-gray-600">AI-driven analysis of your fitness journey</p>
    </div>

    <div class="grid-dashboard">
        <!-- Engagement Score -->
        <div class="stat-card" style="text-align: center;">
            <div class="stat-title">Engagement Score</div>
            <div class="score-circle" style="--score: {{ insights.engagement_score|default:0 }}">
                <div class="score-inner">
                    <div class="score-number">{{ insights.engagement_score|default:0 }}</div>
                </div>
            </div>
            <p style="margin-top: 1rem; font-size: 0.9rem; color: #718096;">Based on attendance & activity</p>
        </div>

        <!-- Churn Risk (Visible to Admin/Staff only? Or keep hidden? Maybe show as 'Consistency Level') -->
        <div class="stat-card">
            <div class="stat-title">Consistency Status</div>
            <div style="margin-top: 1rem;">
                {% if insights.churn_risk == 'low' %}
                <span class="risk-badge risk-low">üî• Extremely Consistent</span>
                {% elif insights.churn_risk == 'medium' %}
                <span class="risk-badge risk-medium">‚ö†Ô∏è Getting Off Track</span>
                {% else %}
                <span class="risk-badge risk-high">üö® Needs Attention</span>
                {% endif %}
            </div>
            <p style="margin-top: 1rem; color: #718096;">
                Last visit: {{ insights.last_visit_days }} days ago
            </p>
        </div>

        <!-- Attendance Stats -->
        <div class="stat-card">
            <div class="stat-title">Monthly Visits</div>
            <div class="stat-value">{{ insights.monthly_visits|default:0 }}</div>
            <div class="stat-title" style="margin-top: 1.5rem;">Total Workouts</div>
            <div class="stat-value" style="font-size: 1.5rem;">{{ insights.total_workouts|default:0 }}</div>
        </div>
    </div>

    <!-- AI Recommendations -->
    <div class="chart-container">
        <h3 style="margin-bottom: 1.5rem; color: #2d3748;">ü§ñ AI Recommendations</h3>
        <div
            style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1.5rem; border-radius: 0 10px 10px 0;">
            {% if insights.engagement_score > 70 %}
            <p><strong>Great job!</strong> You are highly consistent. Consider increasing your workout intensity or
                trying a new class to challenge yourself.</p>
            {% elif insights.engagement_score > 40 %}
            <p><strong>Good effort!</strong> Try to establish a more regular schedule. Aim for at least 3 days a week to
                build momentum.</p>
            {% else %}
            <p><strong>Let's get back on track!</strong> It's been a while. Start with small, manageable workouts. A
                20-minute session is better than nothing!</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
